<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>By‑The‑Beard • Weekly Game Roster</title>
    <!-- Tailwind (jit CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* ---------- Custom tweaks ---------- */
      body{background:#1a1840;color:#e9e7fd;font-family:ui-sans-serif,system-ui,sans-serif}
      .card-gradient{background:linear-gradient(180deg,#393086 0%,#6040d4 55%,#6b3de0 100%)}
      .tag{background:rgba(255,255,255,.08)}
    </style>
  </head>
  <body class="min-h-full flex flex-col items-center py-14 px-4 lg:px-0">
    <!-- --------------------------------- Header --------------------------------- -->
    <header class="mb-12 text-center max-w-xl">
      <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight leading-tight">Weekly Game Roster</h1>
      <p class="mt-2 text-base md:text-lg opacity-80">Auto‑pulled from GitHub every Sunday</p>
      <!-- Filters -->
      <div class="mt-6 flex flex-wrap justify-center gap-4 text-sm">
        <label class="flex items-center gap-2">
          <input id="filter-solo" type="checkbox" class="accent-purple-600 scale-125" checked> Solo
        </label>
        <label class="flex items-center gap-2">
          <input id="filter-coop" type="checkbox" class="accent-purple-600 scale-125" checked> Co‑op
        </label>
        <input id="search" type="text" placeholder="Search title / tag" class="px-3 py-1.5 rounded-lg bg-white/10 placeholder-purple-200 focus:ring-2 focus:ring-purple-500 w-48" />
      </div>
    </header>

    <!-- --------------------------------- Cards --------------------------------- -->
    <main id="cards" class="grid gap-8 w-full max-w-7xl sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></main>

    <template id="card-template">
      <article class="card-gradient rounded-3xl shadow-xl overflow-hidden flex flex-col min-h-[260px] transition-all hover:scale-[1.02]">
        <div class="p-6 flex flex-col grow">
          <h2 class="text-2xl font-bold mb-1 title leading-snug"></h2>
          <p class="text-sm mb-2 opacity-80 night"></p>
          <p class="text-sm mb-4 opacity-70 deal"></p>
          <div class="flex flex-wrap gap-1 tag-box mb-4"></div>
          <a class="mt-auto inline-flex items-center gap-1 self-start bg-fuchsia-600 hover:bg-fuchsia-500 active:scale-95 text-white text-xs font-semibold px-4 py-1.5 rounded-full" target="_blank">Get Deal</a>
        </div>
      </article>
    </template>

    <footer class="mt-16 text-xs opacity-60">GitHub Pages • built for <em>By‑The‑Beard</em></footer>

    <!-- --------------------------------- JS --------------------------------- -->
    <script>
      const USER = 'fletchdat';
      const REPO = 'stream-rosters';

      const today = new Date();
      const offset = today.getDay(); // 0=Sun
      const sunday = new Date(today); sunday.setDate(today.getDate()-offset);
      const defaultDate = new URLSearchParams(location.search).get('date') || sunday.toISOString().slice(0,10);
      const url = `https://${USER}.github.io/${REPO}/data/rosters/${defaultDate}.json`;

      const cardsEl   = document.getElementById('cards');
      const tpl       = document.getElementById('card-template');
      let roster      = [];

      async function load(){
        try{
          roster = await fetch(url).then(r=>r.json());
          render();
        }catch(e){
          console.error(e);
          cardsEl.innerHTML = `<p class='col-span-full text-center text-red-400'>Roster for ${defaultDate} not found.</p>`;
        }
      }

      // filters
      const soloChk  = document.getElementById('filter-solo');
      const coopChk  = document.getElementById('filter-coop');
      const searchIn = document.getElementById('search');
      [soloChk,coopChk,searchIn].forEach(el=>el.addEventListener('input',render));

      function passesFilters(g){
        const typeOk = (g.type==='solo'&&soloChk.checked)||(g.type==='co-op'&&coopChk.checked);
        const term = searchIn.value.trim().toLowerCase();
        const text = `${g.title} ${(g.tags||[]).join(' ')}`.toLowerCase();
        return typeOk && (!term || text.includes(term));
      }

      function render(){
        cardsEl.innerHTML='';
        roster.filter(passesFilters).forEach(g=>{
          const c = tpl.content.firstElementChild.cloneNode(true);
          c.querySelector('.title').textContent = g.title;
          c.querySelector('.night').textContent = g.night? `${g.night} • ${g.type}`:`Bench • ${g.type}`;
          c.querySelector('.deal').textContent  = `${g.deal} • €${g.priceEUR}`;
          c.querySelector('a').href             = g.dealURL||'#';
          // tags
          const box = c.querySelector('.tag-box');
          (g.tags||[]).forEach(t=>{
            const s=document.createElement('span');
            s.className='tag text-[10px] px-2 py-[2px] rounded-full';
            s.textContent=t; box.appendChild(s);
          });
          cardsEl.appendChild(c);
        });
      }

      load();
    </script>
  </body>
</html>
